/*
html-bind - 0.0.1
https://github.com/dekel/html-bind-js#readme
*/
window&&!window.htmlBindJs&&(window.htmlBindJs={attributePrefix:"dk",bindObjects:{}});class HtmlBindJs{constructor({key:t,data:e,parentElem:i,process:a}={}){this.hbBindObjects=window.htmlBindJs.bindObjects,this.attributePrefix=window.htmlBindJs.attributePrefix,this.attributes={BIND_TEXT:this.attributePrefix+"-bind-text",BIND_VALUE:this.attributePrefix+"-bind-value",DATA_EACH:this.attributePrefix+"-data-each",IF:this.attributePrefix+"-if",DATA_AS:this.attributePrefix+"-data-as"},t&&this.register({key:t,data:e,parentElem:i,process:a})}register({key:t,data:e,parentElem:i,process:a}){if(this.hbBindObjects[t])throw`The key [${t}] is already registered`;this.hbBindObjects[t]=e,this.key=t,this.parentElem=i||document,a&&this.update({parentElem:i})}unregister(){this.hbBindObjects[this.key]&&delete this.hbBindObjects[this.key]}update({key:t=this.key,parentElem:e=this.parentElem,data:i}={}){this.updateBind({key:t,parentElem:e,data:i}),this.updateEach({key:t,parentElem:e,data:i}),this.updateIf({key:t,parentElem:e,data:i})}updateBind({key:t,parentElem:e=document,data:i}){const a=e.querySelectorAll(`[${this.attributes.BIND_TEXT}],[${this.attributes.BIND_VALUE}]`),s=a.length;for(let e=0;e<s;e++){const s=a[e];this.updateBindElem({key:t,parentElem:s,data:i})}this.updateBindElem({key:t,parentElem:e,data:i})}updateBindElem({key:t,parentElem:e,data:i}){if(i||(i=this.hbBindObjects),e.getAttribute){const a=[],s=e.getAttribute(this.attributes.BIND_TEXT),r=e.getAttribute(this.attributes.BIND_VALUE);s&&a.push({attr:this.attributes.BIND_TEXT,dataBind:s,updateFn:this.updateTextElement}),r&&a.push({attr:this.attributes.BIND_VALUE,dataBind:r,updateFn:this.updateValueElement});for(let s=0,r=a.length;s<r;s++){const r=a[s];if(r.dataBind.substr(0,t.length)!==t||!i[t])return;let n=this.getValueFromObject(t,r.dataBind,i);r.updateFn.call(this,e,n)}}}updateEach({key:t,parentElem:e=document,data:i}){const a=e.querySelectorAll(`[${this.attributes.DATA_EACH}]`),s=a.length;for(let e=0;e<s;e++){const s=a[e];let r;if(i)r=i;else{if((r=s.getAttribute(this.attributes.DATA_EACH)).substr(0,t.length)!==t||!this.hbBindObjects[t])return}const n=s.getAttribute(this.attributes.DATA_AS),h=this.getValueFromObject(t,r),d=s.parentNode,l=s.content.firstElementChild;d.removeChild(s);const u=4*Math.random(),o=h.length;for(let t=0;t<o;t++)this.updateForEachChild({arrayItemData:h[t],arrayItemIndex:t,elemContent:l,asAttrib:n,parentElem:d,processId:u});this.removeChildren(d,u),d.appendChild(s)}}updateIf({key:t,parentElem:e=document,data:i}){const a=e.querySelectorAll(`[${this.attributes.IF}]`),s=a.length;for(let e=0;e<s;e++){const s=a[e];this.updateIfElem({key:t,parentElem:s,data:i})}this.updateIfElem({key:t,parentElem:e,data:i})}updateIfElem({key:t,parentElem:e,data:i}){if(i||(i=this.hbBindObjects),e.getAttribute){const a=e.getAttribute(this.attributes.IF);if(!a)return;if(a.substr(0,t.length)!==t||!i[t])return;const s=a.substr(t.length+1),r=this.getProp(i[t],s);if(!r)return;const n=r.call(i[t]),h=e.parentElement,d=`__${a}__`;let l=h.querySelector(`[hb-id='${d}']`);if(n){if(!l){const a=document.importNode(e.content,!0),s=document.createElement("span");s.appendChild(a),this.update({key:t,parentElem:s,data:i}),s.setAttribute("hb-id",d),h.appendChild(s)}}else l&&h.removeChild(l)}}updateForEachChild({arrayItemData:t,arrayItemIndex:e,elemContent:i,asAttrib:a,parentElem:s,processId:r}){const n=i.cloneNode(!0),h={};h[a]=t;const d=s.children[e],l=this.getObjectHash(h);let u=!0;(!d||d.hbHash&&d.hbHash!==l||!d.hbHash)&&(u=!1),u?d.hbProcessId=r:(this.update({key:a,parentElem:n,data:h}),n.hbHash=l,n.hbProcessId=r,d?d.hbHash!==n.hbHash&&s.replaceChild(n,d):s.appendChild(n))}removeChildren(t,e){const i=t.children,a=i.length,s=[];for(let t=0;t<a;t++){let a=i[t];"TEMPLATE"!==a.nodeName&&a.hbProcessId!==e&&s.push(a)}s.forEach(e=>{t.removeChild(e)})}getValueFromObject(t,e,i){let a="";if(i||(i=this.hbBindObjects),t.length===e.length)a=JSON.stringify(i[t]);else{const s=e.substr(t.length+1);a=this.getProp(i[t],s)}return a}updateTextElement(t,e){const i=this.getStringHash(e);(t.hbHash&&t.hbHash!==i||!t.hbHash)&&(t.innerText=e||"",t.hbHash=i)}updateValueElement(t,e){const i=this.getStringHash(e);(t.hbHash&&t.hbHash!==i||!t.hbHash)&&(t.value=e||""),t.hbHash=i}getStringHash(t){var e=0,i=t.length,a=0;if(i>0)for(;a<i;)e=(e<<5)-e+t.charCodeAt(a++)|0;return e}getProp(t,e,i){const a=Array.isArray(e)?e:e.split(".").filter(t=>t.length);return a.length?null===t||void 0===t||void 0===t[a[0]]?i:this.getProp(t[a.shift()],a,i):void 0===t?i:t}getObjectHash(t){const e=JSON.stringify(t);return this.getStringHash(e)}findSiblingOfType(t,e){e=e.toUpperCase();let i=t;for(;i;){if(i!==this&&i.nodeType===Node.ELEMENT_NODE&&i.nodeName===e)return t;i=i.nextElementSibling||i.nextSibling}}}export default HtmlBindJs;
//# sourceMappingURL=html-bind.js.map