/*
html-bind - 0.0.1
https://github.com/dekel/html-bind-js#readme
*/
window&&!window.htmlBindJs&&(window.htmlBindJs={attributePrefix:"dk",bindObjects:{}});class HtmlBindJs{constructor({key:t,data:e,parentElem:i,process:s}={}){this.hbBindObjects=window.htmlBindJs.bindObjects,this.attributePrefix=window.htmlBindJs.attributePrefix,this.attribBindsSeparator=";",this.attribBindDirectiveSeparator=":",this.attribBindDirectiveKeySeparator=">",this.attributes={BIND:this.attributePrefix+"-bind",BIND_TEXT:"text",BIND_VALUE:"value",DATA_EACH:"each",DATA_AS:"each-as",IF:"if"},this.directives={text:{fn:this.updateText},value:{fn:this.updateValue},each:{fn:this.updateEach},if:{fn:this.updateIf}},t&&this.register({key:t,data:e,parentElem:i,process:s})}register({key:t,data:e,parentElem:i,process:s}){if(this.hbBindObjects[t])throw`The key [${t}] is already registered`;this.hbBindObjects[t]=e,this.key=t,this.parentElem=i||document,s&&this.update({parentElem:i})}unregister(){this.hbBindObjects[this.key]&&delete this.hbBindObjects[this.key]}update({key:t=this.key,parentElem:e=this.parentElem,data:i}={}){const s=e.querySelectorAll(`[${this.attributes.BIND}]`),r=s.length;for(let e=0;e<r;e++){const r=s[e];this.updateElement({key:t,elem:r,data:i})}this.updateElement({key:t,elem:e,data:i})}updateElement({key:t,elem:e,data:i}){const s=e.getAttribute&&e.getAttribute(this.attributes.BIND);if(!s)return;const r=s.split(this.attribBindsSeparator),n=r.length;for(let s=0;s<n;s++){const n=r[s];if(!n)continue;const a=n.split(this.attribBindDirectiveSeparator),h=a[0].trim(),d=a[1].trim();h&&this.directives[h]&&this.directives[h].fn.call(this,{key:t,data:i,directive:h,details:d,parentElem:e,bindItems:a})}}updateText({key:t,parentElem:e=document,data:i,directive:s,details:r,bindItems:n}){if(i||(i=this.hbBindObjects),r.substr(0,t.length)!==t||!i[t])return;let a=this.getValueFromObject(t,r,i);this.updateTextElement.call(this,e,a)}updateValue({key:t,parentElem:e=document,data:i,directive:s,details:r,bindItems:n}){if(i||(i=this.hbBindObjects),r.substr(0,t.length)!==t||!i[t])return;let a=this.getValueFromObject(t,r,i);this.updateValueElement.call(this,e,a)}updateEach({key:t,parentElem:e=document,data:i,directive:s,details:r,bindItems:n}){const a=e;let h;if(i)h=i;else{if(i=this.hbBindObjects,(h=r).substr(0,t.length)!==t||!this.hbBindObjects[t])return}const d=h.substr(t.length+1).split("in");if(!d.length||2!==d.length)return;const l=d[0].trim(),o=this.getProp(i[t],d[1].trim()),c=a.parentNode,b=a.content.firstElementChild;c.removeChild(a);const u=4*Math.random(),p=o.length;for(let t=0;t<p;t++)this.updateForEachChild({arrayItemData:o[t],arrayItemIndex:t,elemContent:b,asAttrib:l,parentElem:c,processId:u});this.removeChildren(c,u),c.appendChild(a)}updateIf({key:t,parentElem:e=document,data:i,directive:s,details:r,bindItems:n}){if(i||(i=this.hbBindObjects),e.getAttribute){if(!r)return;if(r.substr(0,t.length)!==t||!i[t])return;const s=r.substr(t.length+1),n=this.getProp(i[t],s);if(!n)return;const a=n.call(i[t]),h=e.parentElement,d=`__${r}__`;let l=h.querySelector(`[hb-id='${d}']`);if(a){if(!l){const s=document.importNode(e.content,!0),r=document.createElement("span");r.appendChild(s),this.update({key:t,parentElem:r,data:i}),r.setAttribute("hb-id",d),h.appendChild(r)}}else l&&h.removeChild(l)}}updateForEachChild({arrayItemData:t,arrayItemIndex:e,elemContent:i,asAttrib:s,parentElem:r,processId:n}){const a=i.cloneNode(!0),h={};h[s]=t;const d=r.children[e],l=this.getObjectHash(h);let o=!0;(!d||d.hbHash&&d.hbHash!==l||!d.hbHash)&&(o=!1),o?d.hbProcessId=n:(this.update({key:s,parentElem:a,data:h}),a.hbHash=l,a.hbProcessId=n,d?d.hbHash!==a.hbHash&&r.replaceChild(a,d):r.appendChild(a))}removeChildren(t,e){const i=t.children,s=i.length,r=[];for(let t=0;t<s;t++){let s=i[t];"TEMPLATE"!==s.nodeName&&s.hbProcessId!==e&&r.push(s)}r.forEach(e=>{t.removeChild(e)})}getValueFromObject(t,e,i){let s="";if(i||(i=this.hbBindObjects),t.length===e.length)s=JSON.stringify(i[t]);else{const r=e.substr(t.length+1);s=this.getProp(i[t],r)}return s}updateTextElement(t,e){const i=this.getStringHash(e);(t.hbHash&&t.hbHash!==i||!t.hbHash)&&(t.innerText=e||"",t.hbHash=i)}updateValueElement(t,e){const i=this.getStringHash(e);(t.hbHash&&t.hbHash!==i||!t.hbHash)&&(t.value=e||""),t.hbHash=i}getStringHash(t){var e=0,i=t.length,s=0;if(i>0)for(;s<i;)e=(e<<5)-e+t.charCodeAt(s++)|0;return e}getProp(t,e,i){const s=Array.isArray(e)?e:e.split(".").filter(t=>t.length);return s.length?null===t||void 0===t||void 0===t[s[0]]?i:this.getProp(t[s.shift()],s,i):void 0===t?i:t}getObjectHash(t){const e=JSON.stringify(t);return this.getStringHash(e)}findSiblingOfType(t,e){e=e.toUpperCase();let i=t;for(;i;){if(i!==this&&i.nodeType===Node.ELEMENT_NODE&&i.nodeName===e)return t;i=i.nextElementSibling||i.nextSibling}}}export default HtmlBindJs;
//# sourceMappingURL=html-bind.js.map